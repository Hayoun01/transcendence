generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum LanguageType {
  eng
  fr
}

model UserProfile {
  id                String        @id
  username          String        @unique
  avatarPath        String?       @map("avatar_path")
  avatarName        String?       @map("avatar_name")
  bio               String?
  language          LanguageType  @default(eng)
  createdAt         DateTime      @default(now()) @map("created_at")
  updatedAt         DateTime      @updatedAt @map("updated_at")
  sentFriendReq     Friendship[]  @relation("Requester")
  receivedFriendReq Friendship[]  @relation("Receiver")
  BlockedUsers      BlockedUser[] @relation("BlockedUsers")
  BlockedByUsers    BlockedUser[] @relation("BlockedByUsers")

  @@map("user_profiles")
}

enum FriendshipStatus {
  pending
  accepted
  declined
  canceled
}

model Friendship {
  id          String           @id @default(uuid(7))
  requesterId String           @map("requester_id")
  receiverId  String           @map("receiver_id")
  status      FriendshipStatus @default(pending)
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt @map("updated_at")

  requester UserProfile @relation("Requester", references: [id], fields: [requesterId])
  receiver  UserProfile @relation("Receiver", references: [id], fields: [receiverId])

  @@unique([requesterId, receiverId])
  @@map("friendships")
}

model BlockedUser {
  id        String   @id @default(uuid(7))
  blockerId String   @map("blocker_id")
  blockedId String   @map("blocked_id")
  createdAt DateTime @default(now()) @map("created_at")

  blocker UserProfile @relation("BlockedUsers", references: [id], fields: [blockerId])
  blocked UserProfile @relation("BlockedByUsers", references: [id], fields: [blockedId])

  @@unique([blockerId, blockedId])
  @@map("blocked_users")
}
